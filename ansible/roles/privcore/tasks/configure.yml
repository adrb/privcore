---

- name: forcing redirect to SSL in /etc/apache2/sites-available/000-default.conf
  blockinfile:
    dest: /etc/apache2/sites-available/000-default.conf
    marker: "# {mark} ANSIBLE MANAGED BLOCK "
    block: |

      Redirect permanent /ldapadmin https://{{config.internet_domain}}/ldapadmin
      Redirect permanent /roundcube https://{{config.internet_domain}}/roundcube
      Redirect permanent /nextcloud  https://{{config.internet_domain}}/nextcloud

    insertbefore: "</VirtualHost>"
  notify: reload httpd

- name: preparing directories
  file: path=/var/www/html/{{ item }} state=directory mode=0755
  with_items:
    - "imgs"
    - "css"

- name: deploying privcore welcome page files
  copy: src={{ item }} dest=/var/www/html/{{ item }} force=no
  with_items:
    - "imgs/roundcube.png"
    - "imgs/phpLDAPadmin.png"
    - "imgs/favicon.ico"
    - "imgs/privcore_logo_black2.png"
    - "imgs/nextcloud.png"
    - "imgs/change_password.png"
    - "css/bootstrap.min.css"
    - "css/style.css"

- name: generating privcore /var/www/html/index.html file
  template: src=index.html.j2 dest=/var/www/html/index.html

- name: generating privcore /var/www/html/ldap_passwd.php file
  template: src=ldap_passwd.php.j2 dest=/var/www/html/ldap_passwd.php

